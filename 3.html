<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²çˆ±çš„é—µè€å¸ˆï¼Œç”Ÿæ—¥å¿«ä¹ï¼</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            cursor: pointer;
            position: relative;
        }

        #birthday-container {
            position: relative;
            z-index: 100;
            width: 100%;
            height: 100%;
        }

        .birthday-photo {
            position: absolute;
            object-fit: cover;
            border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
            opacity: 0;
            transition: all 1s ease;
            display: none;
            transform-origin: center;
        }

        .birthday-photo.show {
            opacity: 1;
            display: block;
        }

        #birthday-text {
            position: absolute;
            top: 90%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 3em;
            text-shadow: 0 0 10px rgba(170, 0, 255, 0.32), 0 0 20px #fffb00, 0 0 30px #6600ff;
            opacity: 0;
            transition: all 1s ease 0.5s;
            margin-bottom: 15px;
            text-align: center;
            width: 70%;
        }

        #birthday-text.show {
            opacity: 1;
        }

        #birthday-message {
            position: absolute;
            top: 80%;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 2em;
            text-shadow: 0 0 10px #ff00ff, 0 0 20px rgba(255, 0, 119, 0.7), 0 0 30px #00e1ff;
            max-width: 80%;
            opacity: 0;
            transition: all 1s ease 1s;
            text-align: center;
            width: 40%;
        }

        #birthday-message.show {
            opacity: 1;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #start-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            font-size: 1.5em;
            background: linear-gradient(45deg, #ff3366, #ff8c00);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
        }

        .heart {
            position: absolute;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 10;
            font-size: 20px;
        }

        #fireworks-control {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #speed-control {
            position: fixed;
            bottom: 140px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <button id="start-button">ç‚¹å‡»å¼€å§‹ç¥ç¦</button>

    <div id="birthday-container">
        <img class="birthday-photo" id="photo1" alt="ç”Ÿæ—¥ç…§ç‰‡1">
        <img class="birthday-photo" id="photo2" alt="ç”Ÿæ—¥ç…§ç‰‡2">
        <img class="birthday-photo" id="photo3" alt="ç”Ÿæ—¥ç…§ç‰‡3">
        <img class="birthday-photo" id="photo4" alt="ç”Ÿæ—¥ç…§ç‰‡4">
        <img class="birthday-photo" id="photo5" alt="ç”Ÿæ—¥ç…§ç‰‡5">

        <h1 id="birthday-text">äº²çˆ±çš„é—µè€å¸ˆï¼Œç”Ÿæ—¥å¿«ä¹ï¼</h1>
        <p id="birthday-message">æ„¿æ‰€æœ‰çš„å¿«ä¹ã€æ‰€æœ‰çš„å¹¸ç¦ã€æ‰€æœ‰çš„æ¸©é¦¨ã€æ‰€æœ‰çš„å¥½è¿éƒ½å›´ç»•åœ¨æ‚¨èº«è¾¹ï¼</p>
    </div>

    <canvas id="fireworks"></canvas>

    <button id="music-control">ğŸ”Š</button>
    <button id="fireworks-control">ğŸ†</button>
    <button id="speed-control">â©</button>

    <audio id="birthday-music" onerror="alert('éŸ³ä¹åŠ è½½å¤±è´¥ï¼')">
        <source src="/to-Ms.Min/birthday-music.mp3" type="audio/mpeg">
    </audio>

    <script>
        // åˆå§‹åŒ–å…ƒç´ 
        const startButton = document.getElementById('start-button');
        const birthdayPhotos = [
            document.getElementById('photo1'),
            document.getElementById('photo2'),
            document.getElementById('photo3'),
            document.getElementById('photo4'),
            document.getElementById('photo5')
        ];
        const birthdayText = document.getElementById('birthday-text');
        const birthdayMessage = document.getElementById('birthday-message');
        const musicControl = document.getElementById('music-control');
        const fireworksControl = document.getElementById('fireworks-control');
        const speedControl = document.getElementById('speed-control');
        const birthdayMusic = document.getElementById('birthday-music');
        const canvas = document.getElementById('fireworks');
        const ctx = canvas.getContext('2d');

        // è®¾ç½®ç”»å¸ƒå¤§å°
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´ç”»å¸ƒ
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // å½“å‰ç…§ç‰‡ç´¢å¼•
        let currentPhotoIndex = 0;
        let photoInterval;
        let fireworksEnabled = true;
        let isMusicSpedUp = false;

        // åŠ è½½ç…§ç‰‡å¹¶éšæœºå®šä½
        function loadAndPositionPhotos() {
            birthdayPhotos.forEach((photo, index) => {
                // åŠ è½½ç…§ç‰‡
                photo.src = `/to-Ms.Min/birthday-photo${index+1}.jpg`;

                // éšæœºå¤§å° (200-400px)
                const size = Math.random() * 300 + 300;
                photo.style.width = `${size}px`;
                photo.style.height = `${size}px`;

                // éšæœºä½ç½® (ç¡®ä¿å®Œå…¨æ˜¾ç¤ºåœ¨å±å¹•å†…)
                const maxX = window.innerWidth - size;
                const maxY = window.innerHeight - size;
                const posX = Math.random() * maxX;
                const posY = Math.random() * maxY;

                photo.style.left = `${posX}px`;
                photo.style.top = `${posY}px`;

                // éšæœºæ—‹è½¬ (-30åˆ°30åº¦)
                const rotation = (Math.random() * 20) - 10;
                photo.style.transform = `rotate(${rotation}deg)`;
            });
        }

        // æ˜¾ç¤ºä¸‹ä¸€å¼ ç…§ç‰‡
        function showNextPhoto() {
            // éšè—å½“å‰ç…§ç‰‡
            birthdayPhotos[currentPhotoIndex].classList.remove('show');

            // æ›´æ–°ç´¢å¼•
            currentPhotoIndex = (currentPhotoIndex + 1) % birthdayPhotos.length;

            // æ˜¾ç¤ºæ–°ç…§ç‰‡
            birthdayPhotos[currentPhotoIndex].classList.add('show');
        }

        // å¼€å§‹ç…§ç‰‡è½®æ’­
        function startPhotoCarousel() {
            // å…ˆæ˜¾ç¤ºç¬¬ä¸€å¼ 
            birthdayPhotos[0].classList.add('show');

            // æ¯éš”3ç§’åˆ‡æ¢ç…§ç‰‡
            photoInterval = setInterval(showNextPhoto, 3000);
        }

        // åŠ é€ŸéŸ³ä¹æ’­æ”¾
        function speedUpMusic() {
            if (birthdayMusic.duration) {
                // è®¡ç®—éœ€è¦çš„æ’­æ”¾é€Ÿåº¦ï¼Œä½¿éŸ³ä¹åœ¨1åˆ†é’Ÿå†…å®Œæˆ
                const targetDuration = 60; // 60ç§’
                const speed = birthdayMusic.duration / targetDuration;
                birthdayMusic.playbackRate = speed;
                isMusicSpedUp = true;
                speedControl.textContent = 'â­ï¸';
            } else {
                // å¦‚æœéŸ³ä¹å…ƒæ•°æ®è¿˜æ²¡åŠ è½½ï¼Œç¨åå†è¯•
                setTimeout(speedUpMusic, 100);
            }
        }

        // å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        startButton.addEventListener('click', () => {
            // éšè—å¼€å§‹æŒ‰é’®
            startButton.style.display = 'none';

            // åŠ è½½å¹¶å®šä½ç…§ç‰‡
            loadAndPositionPhotos();

            // æ’­æ”¾éŸ³ä¹å¹¶åŠ é€Ÿ
            birthdayMusic.play().catch(e => console.log("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:", e));
            speedUpMusic();

            // æ˜¾ç¤ºæ–‡å­—
            setTimeout(() => {
                birthdayText.classList.add('show');
            }, 1000);

            setTimeout(() => {
                birthdayMessage.classList.add('show');
                startPhotoCarousel();
            }, 1500);

            // å¼€å§‹çƒŸèŠ±æ•ˆæœ
            startFireworks();
        });

        // éŸ³ä¹æ§åˆ¶æŒ‰é’®
        let isMusicPlaying = true;
        musicControl.addEventListener('click', () => {
            if (isMusicPlaying) {
                birthdayMusic.pause();
                musicControl.textContent = 'ğŸ”‡';
            } else {
                birthdayMusic.play();
                musicControl.textContent = 'ğŸ”Š';
            }
            isMusicPlaying = !isMusicPlaying;
        });

        // çƒŸèŠ±æ§åˆ¶æŒ‰é’®
        fireworksControl.addEventListener('click', () => {
            fireworksEnabled = !fireworksEnabled;
            if (fireworksEnabled) {
                fireworksControl.style.opacity = '1';
            } else {
                fireworksControl.style.opacity = '0.5';
            }
        });

        // é€Ÿåº¦æ§åˆ¶æŒ‰é’®
        speedControl.addEventListener('click', () => {
            if (isMusicSpedUp) {
                birthdayMusic.playbackRate = 1.0;
                isMusicSpedUp = false;
                speedControl.textContent = 'â©';
            } else {
                speedUpMusic();
            }
        });

        // çƒŸèŠ±æ•ˆæœ
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = {
                    x: (Math.random() - 0.5) * 12,
                    y: (Math.random() - 0.5) * 12
                };
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.01;
                this.size = Math.random() * 5 + 2;
                this.type = Math.random() > 0.5 ? 'circle' :
                           Math.random() > 0.7 ? 'star' : 'heart';
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
            }

            update() {
                this.velocity.y += 0.05; // é‡åŠ›
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= this.decay;
                this.rotation += this.rotationSpeed;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;

                if (this.type === 'star') {
                    // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
                    ctx.beginPath();
                    const spikes = 5;
                    const outerRadius = this.size;
                    const innerRadius = this.size / 2;
                    let rot = this.rotation;
                    let x = this.x;
                    let y = this.y;
                    let step = Math.PI / spikes;

                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y - outerRadius);
                    for (let i = 0; i < spikes; i++) {
                        x = this.x + Math.cos(rot) * outerRadius;
                        y = this.y + Math.sin(rot) * outerRadius;
                        ctx.lineTo(x, y);
                        rot += step;

                        x = this.x + Math.cos(rot) * innerRadius;
                        y = this.y + Math.sin(rot) * innerRadius;
                        ctx.lineTo(x, y);
                        rot += step;
                    }
                    ctx.lineTo(this.x, this.y - outerRadius);
                    ctx.closePath();
                    ctx.fill();
                } else if (this.type === 'heart') {
                    // ç»˜åˆ¶çˆ±å¿ƒ
                    ctx.beginPath();
                    const topCurveHeight = this.size * 0.3;
                    ctx.moveTo(this.x, this.y + topCurveHeight);
                    // å·¦ä¾§æ›²çº¿
                    ctx.bezierCurveTo(
                        this.x, this.y,
                        this.x - this.size, this.y,
                        this.x - this.size, this.y + topCurveHeight
                    );
                    // åº•éƒ¨å·¦ä¾§æ›²çº¿
                    ctx.bezierCurveTo(
                        this.x - this.size, this.y + (this.size * 0.7),
                        this.x, this.y + (this.size * 1.3),
                        this.x, this.y + this.size
                    );
                    // åº•éƒ¨å³ä¾§æ›²çº¿
                    ctx.bezierCurveTo(
                        this.x, this.y + (this.size * 1.3),
                        this.x + this.size, this.y + (this.size * 0.7),
                        this.x + this.size, this.y + topCurveHeight
                    );
                    // å³ä¾§æ›²çº¿
                    ctx.bezierCurveTo(
                        this.x + this.size, this.y,
                        this.x, this.y,
                        this.x, this.y + topCurveHeight
                    );
                    ctx.closePath();
                    ctx.fill();
                } else {
                    // ç»˜åˆ¶åœ†å½¢
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.closePath();
                    ctx.fill();
                }

                ctx.restore();
            }
        }

        class Firework {
            constructor(x, y, targetX, targetY, color, type = 'normal') {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.color = color;
                this.particles = [];
                this.speed = type === 'special' ? 6 : 4;
                this.angle = Math.atan2(targetY - y, targetX - x);
                this.velocity = {
                    x: Math.cos(this.angle) * this.speed,
                    y: Math.sin(this.angle) * this.speed
                };
                this.exploded = false;
                this.type = type;
                this.trail = [];
                this.maxTrail = 20;
            }

            update() {
                if (!this.exploded) {
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;

                    // è®°å½•è½¨è¿¹
                    this.trail.push({x: this.x, y: this.y});
                    if (this.trail.length > this.maxTrail) {
                        this.trail.shift();
                    }

                    // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡ä½ç½®
                    const distance = Math.hypot(this.targetX - this.x, this.targetY - this.y);
                    if (distance < 5) {
                        this.explode();
                    }
                }

                // æ›´æ–°ç²’å­
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    this.particles[i].update();
                    if (this.particles[i].alpha <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }

            draw() {
                if (!this.exploded) {
                    // ç»˜åˆ¶å°¾è¿¹
                    ctx.save();
                    ctx.lineWidth = this.type === 'special' ? 4 : 2;
                    ctx.strokeStyle = this.color;
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    for (let i = 0; i < this.trail.length - 1; i++) {
                        const p1 = this.trail[i];
                        const p2 = this.trail[i+1];
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                    }
                    ctx.stroke();
                    ctx.restore();

                    // ç»˜åˆ¶çƒŸèŠ±å¤´
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.type === 'special' ? 6 : 4, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }

                // ç»˜åˆ¶ç²’å­
                this.particles.forEach(particle => particle.draw());
            }

            explode() {
                this.exploded = true;
                // åˆ›å»ºçˆ†ç‚¸ç²’å­
                const particleCount = this.type === 'special' ? 600 : 300;
                for (let i = 0; i < particleCount; i++) {
                    this.particles.push(new Particle(this.x, this.y, this.color));
                }

                // åˆ›å»ºäºŒæ¬¡çˆ†ç‚¸
                if (this.type === 'special') {
                    setTimeout(() => {
                        for (let i = 0; i < 8; i++) {
                            setTimeout(() => {
                                const angle = (i / 8) * Math.PI * 2;
                                const distance = Math.random() * 80 + 80;
                                const x = this.x + Math.cos(angle) * distance;
                                const y = this.y + Math.sin(angle) * distance;
                                createMiniExplosion(x, y, this.color);
                            }, i * 100);
                        }
                    }, 500);
                }
            }
        }

        // åˆ›å»ºè¿·ä½ çˆ†ç‚¸æ•ˆæœ
        function createMiniExplosion(x, y, color) {
            const particles = [];
            for (let i = 0; i < 150; i++) {
                particles.push(new Particle(x, y, color));
            }

            function update() {
                ctx.save();

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.update();

                    if (p.alpha <= 0) {
                        particles.splice(i, 1);
                    } else {
                        p.draw();
                    }
                }

                ctx.restore();

                if (particles.length > 0) {
                    requestAnimationFrame(update);
                }
            }

            update();
        }

        const fireworks = [];

        function createFirework(x, y, type = 'normal') {
            if (!fireworksEnabled && type === 'normal') return;

            const startX = x || Math.random() * canvas.width;
            const startY = y || canvas.height;
            const targetX = x || Math.random() * canvas.width;
            const targetY = y || Math.random() * canvas.height / 2;

            const hue = Math.floor(Math.random() * 360);
            const saturation = 100;
            const lightness = type === 'special' ? 80 : 60;
            const color = `hsl(${hue}, ${saturation}%, ${lightness}%)`;

            fireworks.push(new Firework(startX, startY, targetX, targetY, color, type));
        }

        function startFireworks() {
            animate();

            // éšæœºè‡ªåŠ¨å‘å°„çƒŸèŠ±
            setInterval(() => {
                if (Math.random() < 0.6) {
                    createFirework();
                }
                // 40%æ¦‚ç‡å‘å°„ç‰¹æ®ŠçƒŸèŠ±
                if (Math.random() < 0.4) {
                    createFirework(null, null, 'special');
                }
            }, 200);

            // ç‚¹å‡»å‘å°„çƒŸèŠ±
            canvas.addEventListener('click', (e) => {
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createFirework(e.clientX, e.clientY, i % 2 === 0 ? 'special' : 'normal');
                    }, i * 100);
                }
            });

            // è§¦æ‘¸æ”¯æŒ
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createFirework(touch.clientX, touch.clientY, i % 2 === 0 ? 'special' : 'normal');
                    }, i * 100);
                }
            }, { passive: false });
        }

        function animate() {
            requestAnimationFrame(animate);

            // åŠé€æ˜é»‘è‰²èƒŒæ™¯ï¼Œåˆ›å»ºæ‹–å°¾æ•ˆæœ
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
            fireworks.forEach((firework, index) => {
                firework.update();
                firework.draw();

                // ç§»é™¤å·²ç»æ¶ˆå¤±çš„çƒŸèŠ±
                if (firework.exploded && firework.particles.length === 0) {
                    fireworks.splice(index, 1);
                }
            });
        }

        // çˆ±å¿ƒæ•ˆæœ
        function createHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = 'â¤ï¸';
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            heart.style.fontSize = `${Math.random() * 20 + 10}px`;
            document.body.appendChild(heart);

            // çˆ±å¿ƒåŠ¨ç”»
            let size = 1;
            let opacity = 1;
            const animation = setInterval(() => {
                size += 0.05;
                opacity -= 0.02;
                heart.style.transform = `translate(-50%, -50%) scale(${size})`;
                heart.style.opacity = opacity;

                if (opacity <= 0) {
                    clearInterval(animation);
                    heart.remove();
                }
            }, 50);
        }
    </script>
</body>
</html>