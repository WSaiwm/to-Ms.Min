<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>亲爱的闵老师，生日快乐！</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            cursor: pointer;
            position: relative;
        }

        #birthday-container {
            position: relative;
            z-index: 100;
            width: 100%;
            height: 100%;
        }

        .birthday-photo {
            position: absolute;
            object-fit: cover;
            border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
            opacity: 0;
            transition: all 1s ease;
            display: none;
            transform-origin: center;
        }

        .birthday-photo.show {
            opacity: 1;
            display: block;
        }

        #birthday-text {
            position: absolute;
            top: 90%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 3em;
            text-shadow: 0 0 10px rgba(170, 0, 255, 0.32), 0 0 20px #fffb00, 0 0 30px #6600ff;
            opacity: 0;
            transition: all 1s ease 0.5s;
            margin-bottom: 15px;
            text-align: center;
            width: 70%;
        }

        #birthday-text.show {
            opacity: 1;
        }

        #birthday-message {
            position: absolute;
            top: 80%;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            font-size: 2em;
            text-shadow: 0 0 10px #ff00ff, 0 0 20px rgba(255, 0, 119, 0.7), 0 0 30px #00e1ff;
            max-width: 80%;
            opacity: 0;
            transition: all 1s ease 1s;
            text-align: center;
            width: 40%;
        }

        #birthday-message.show {
            opacity: 1;
        }

        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #start-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            font-size: 1.5em;
            background: linear-gradient(45deg, #ff3366, #ff8c00);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.8);
        }

        .heart {
            position: absolute;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 10;
            font-size: 20px;
        }

        #fireworks-control {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #speed-control {
            position: fixed;
            bottom: 140px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <button id="start-button">点击开始祝福</button>

    <div id="birthday-container">
        <img class="birthday-photo" id="photo1" alt="生日照片1">
        <img class="birthday-photo" id="photo2" alt="生日照片2">
        <img class="birthday-photo" id="photo3" alt="生日照片3">
        <img class="birthday-photo" id="photo4" alt="生日照片4">
        <img class="birthday-photo" id="photo5" alt="生日照片5">

        <h1 id="birthday-text">亲爱的闵老师，生日快乐！</h1>
        <p id="birthday-message">愿所有的快乐、所有的幸福、所有的温馨、所有的好运都围绕在您身边！</p>
    </div>

    <canvas id="fireworks"></canvas>

    <button id="music-control">🔊</button>
    <button id="fireworks-control">🎆</button>
    <button id="speed-control">⏩</button>

    <audio id="birthday-music" onerror="alert('音乐加载失败！')">
        <source src="/to-Ms.Min/birthday-music.mp3" type="audio/mpeg">
    </audio>

    <script>
        // 初始化元素
        const startButton = document.getElementById('start-button');
        const birthdayPhotos = [
            document.getElementById('photo1'),
            document.getElementById('photo2'),
            document.getElementById('photo3'),
            document.getElementById('photo4'),
            document.getElementById('photo5')
        ];
        const birthdayText = document.getElementById('birthday-text');
        const birthdayMessage = document.getElementById('birthday-message');
        const musicControl = document.getElementById('music-control');
        const fireworksControl = document.getElementById('fireworks-control');
        const speedControl = document.getElementById('speed-control');
        const birthdayMusic = document.getElementById('birthday-music');
        const canvas = document.getElementById('fireworks');
        const ctx = canvas.getContext('2d');

        // 设置画布大小
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // 窗口大小改变时调整画布
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // 当前照片索引
        let currentPhotoIndex = 0;
        let photoInterval;
        let fireworksEnabled = true;
        let isMusicSpedUp = false;

        // 加载照片并随机定位
        function loadAndPositionPhotos() {
            birthdayPhotos.forEach((photo, index) => {
                // 加载照片
                photo.src = `/to-Ms.Min/birthday-photo${index+1}.jpg`;

                // 随机大小 (200-400px)
                const size = Math.random() * 300 + 300;
                photo.style.width = `${size}px`;
                photo.style.height = `${size}px`;

                // 随机位置 (确保完全显示在屏幕内)
                const maxX = window.innerWidth - size;
                const maxY = window.innerHeight - size;
                const posX = Math.random() * maxX;
                const posY = Math.random() * maxY;

                photo.style.left = `${posX}px`;
                photo.style.top = `${posY}px`;

                // 随机旋转 (-30到30度)
                const rotation = (Math.random() * 20) - 10;
                photo.style.transform = `rotate(${rotation}deg)`;
            });
        }

        // 显示下一张照片
        function showNextPhoto() {
            // 隐藏当前照片
            birthdayPhotos[currentPhotoIndex].classList.remove('show');

            // 更新索引
            currentPhotoIndex = (currentPhotoIndex + 1) % birthdayPhotos.length;

            // 显示新照片
            birthdayPhotos[currentPhotoIndex].classList.add('show');
        }

        // 开始照片轮播
        function startPhotoCarousel() {
            // 先显示第一张
            birthdayPhotos[0].classList.add('show');

            // 每隔3秒切换照片
            photoInterval = setInterval(showNextPhoto, 3000);
        }

        // 加速音乐播放
        function speedUpMusic() {
            if (birthdayMusic.duration) {
                // 计算需要的播放速度，使音乐在1分钟内完成
                const targetDuration = 60; // 60秒
                const speed = birthdayMusic.duration / targetDuration;
                birthdayMusic.playbackRate = speed;
                isMusicSpedUp = true;
                speedControl.textContent = '⏭️';
            } else {
                // 如果音乐元数据还没加载，稍后再试
                setTimeout(speedUpMusic, 100);
            }
        }

        // 开始按钮点击事件
        startButton.addEventListener('click', () => {
            // 隐藏开始按钮
            startButton.style.display = 'none';

            // 加载并定位照片
            loadAndPositionPhotos();

            // 播放音乐并加速
            birthdayMusic.play().catch(e => console.log("自动播放被阻止:", e));
            speedUpMusic();

            // 显示文字
            setTimeout(() => {
                birthdayText.classList.add('show');
            }, 1000);

            setTimeout(() => {
                birthdayMessage.classList.add('show');
                startPhotoCarousel();
            }, 1500);

            // 开始烟花效果
            startFireworks();
        });

        // 音乐控制按钮
        let isMusicPlaying = true;
        musicControl.addEventListener('click', () => {
            if (isMusicPlaying) {
                birthdayMusic.pause();
                musicControl.textContent = '🔇';
            } else {
                birthdayMusic.play();
                musicControl.textContent = '🔊';
            }
            isMusicPlaying = !isMusicPlaying;
        });

        // 烟花控制按钮
        fireworksControl.addEventListener('click', () => {
            fireworksEnabled = !fireworksEnabled;
            if (fireworksEnabled) {
                fireworksControl.style.opacity = '1';
            } else {
                fireworksControl.style.opacity = '0.5';
            }
        });

        // 速度控制按钮
        speedControl.addEventListener('click', () => {
            if (isMusicSpedUp) {
                birthdayMusic.playbackRate = 1.0;
                isMusicSpedUp = false;
                speedControl.textContent = '⏩';
            } else {
                speedUpMusic();
            }
        });

        // 烟花效果
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = {
                    x: (Math.random() - 0.5) * 12,
                    y: (Math.random() - 0.5) * 12
                };
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.01;
                this.size = Math.random() * 5 + 2;
                this.type = Math.random() > 0.5 ? 'circle' :
                           Math.random() > 0.7 ? 'star' : 'heart';
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
            }

            update() {
                this.velocity.y += 0.05; // 重力
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= this.decay;
                this.rotation += this.rotationSpeed;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;

                if (this.type === 'star') {
                    // 绘制星星
                    ctx.beginPath();
                    const spikes = 5;
                    const outerRadius = this.size;
                    const innerRadius = this.size / 2;
                    let rot = this.rotation;
                    let x = this.x;
                    let y = this.y;
                    let step = Math.PI / spikes;

                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y - outerRadius);
                    for (let i = 0; i < spikes; i++) {
                        x = this.x + Math.cos(rot) * outerRadius;
                        y = this.y + Math.sin(rot) * outerRadius;
                        ctx.lineTo(x, y);
                        rot += step;

                        x = this.x + Math.cos(rot) * innerRadius;
                        y = this.y + Math.sin(rot) * innerRadius;
                        ctx.lineTo(x, y);
                        rot += step;
                    }
                    ctx.lineTo(this.x, this.y - outerRadius);
                    ctx.closePath();
                    ctx.fill();
                } else if (this.type === 'heart') {
                    // 绘制爱心
                    ctx.beginPath();
                    const topCurveHeight = this.size * 0.3;
                    ctx.moveTo(this.x, this.y + topCurveHeight);
                    // 左侧曲线
                    ctx.bezierCurveTo(
                        this.x, this.y,
                        this.x - this.size, this.y,
                        this.x - this.size, this.y + topCurveHeight
                    );
                    // 底部左侧曲线
                    ctx.bezierCurveTo(
                        this.x - this.size, this.y + (this.size * 0.7),
                        this.x, this.y + (this.size * 1.3),
                        this.x, this.y + this.size
                    );
                    // 底部右侧曲线
                    ctx.bezierCurveTo(
                        this.x, this.y + (this.size * 1.3),
                        this.x + this.size, this.y + (this.size * 0.7),
                        this.x + this.size, this.y + topCurveHeight
                    );
                    // 右侧曲线
                    ctx.bezierCurveTo(
                        this.x + this.size, this.y,
                        this.x, this.y,
                        this.x, this.y + topCurveHeight
                    );
                    ctx.closePath();
                    ctx.fill();
                } else {
                    // 绘制圆形
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.closePath();
                    ctx.fill();
                }

                ctx.restore();
            }
        }

        class Firework {
            constructor(x, y, targetX, targetY, color, type = 'normal') {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.color = color;
                this.particles = [];
                this.speed = type === 'special' ? 6 : 4;
                this.angle = Math.atan2(targetY - y, targetX - x);
                this.velocity = {
                    x: Math.cos(this.angle) * this.speed,
                    y: Math.sin(this.angle) * this.speed
                };
                this.exploded = false;
                this.type = type;
                this.trail = [];
                this.maxTrail = 20;
            }

            update() {
                if (!this.exploded) {
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;

                    // 记录轨迹
                    this.trail.push({x: this.x, y: this.y});
                    if (this.trail.length > this.maxTrail) {
                        this.trail.shift();
                    }

                    // 检查是否到达目标位置
                    const distance = Math.hypot(this.targetX - this.x, this.targetY - this.y);
                    if (distance < 5) {
                        this.explode();
                    }
                }

                // 更新粒子
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    this.particles[i].update();
                    if (this.particles[i].alpha <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }

            draw() {
                if (!this.exploded) {
                    // 绘制尾迹
                    ctx.save();
                    ctx.lineWidth = this.type === 'special' ? 4 : 2;
                    ctx.strokeStyle = this.color;
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    for (let i = 0; i < this.trail.length - 1; i++) {
                        const p1 = this.trail[i];
                        const p2 = this.trail[i+1];
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                    }
                    ctx.stroke();
                    ctx.restore();

                    // 绘制烟花头
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.type === 'special' ? 6 : 4, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }

                // 绘制粒子
                this.particles.forEach(particle => particle.draw());
            }

            explode() {
                this.exploded = true;
                // 创建爆炸粒子
                const particleCount = this.type === 'special' ? 600 : 300;
                for (let i = 0; i < particleCount; i++) {
                    this.particles.push(new Particle(this.x, this.y, this.color));
                }

                // 创建二次爆炸
                if (this.type === 'special') {
                    setTimeout(() => {
                        for (let i = 0; i < 8; i++) {
                            setTimeout(() => {
                                const angle = (i / 8) * Math.PI * 2;
                                const distance = Math.random() * 80 + 80;
                                const x = this.x + Math.cos(angle) * distance;
                                const y = this.y + Math.sin(angle) * distance;
                                createMiniExplosion(x, y, this.color);
                            }, i * 100);
                        }
                    }, 500);
                }
            }
        }

        // 创建迷你爆炸效果
        function createMiniExplosion(x, y, color) {
            const particles = [];
            for (let i = 0; i < 150; i++) {
                particles.push(new Particle(x, y, color));
            }

            function update() {
                ctx.save();

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.update();

                    if (p.alpha <= 0) {
                        particles.splice(i, 1);
                    } else {
                        p.draw();
                    }
                }

                ctx.restore();

                if (particles.length > 0) {
                    requestAnimationFrame(update);
                }
            }

            update();
        }

        const fireworks = [];

        function createFirework(x, y, type = 'normal') {
            if (!fireworksEnabled && type === 'normal') return;

            const startX = x || Math.random() * canvas.width;
            const startY = y || canvas.height;
            const targetX = x || Math.random() * canvas.width;
            const targetY = y || Math.random() * canvas.height / 2;

            const hue = Math.floor(Math.random() * 360);
            const saturation = 100;
            const lightness = type === 'special' ? 80 : 60;
            const color = `hsl(${hue}, ${saturation}%, ${lightness}%)`;

            fireworks.push(new Firework(startX, startY, targetX, targetY, color, type));
        }

        function startFireworks() {
            animate();

            // 随机自动发射烟花
            setInterval(() => {
                if (Math.random() < 0.6) {
                    createFirework();
                }
                // 40%概率发射特殊烟花
                if (Math.random() < 0.4) {
                    createFirework(null, null, 'special');
                }
            }, 200);

            // 点击发射烟花
            canvas.addEventListener('click', (e) => {
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createFirework(e.clientX, e.clientY, i % 2 === 0 ? 'special' : 'normal');
                    }, i * 100);
                }
            });

            // 触摸支持
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createFirework(touch.clientX, touch.clientY, i % 2 === 0 ? 'special' : 'normal');
                    }, i * 100);
                }
            }, { passive: false });
        }

        function animate() {
            requestAnimationFrame(animate);

            // 半透明黑色背景，创建拖尾效果
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 更新和绘制烟花
            fireworks.forEach((firework, index) => {
                firework.update();
                firework.draw();

                // 移除已经消失的烟花
                if (firework.exploded && firework.particles.length === 0) {
                    fireworks.splice(index, 1);
                }
            });
        }

        // 爱心效果
        function createHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = '❤️';
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            heart.style.fontSize = `${Math.random() * 20 + 10}px`;
            document.body.appendChild(heart);

            // 爱心动画
            let size = 1;
            let opacity = 1;
            const animation = setInterval(() => {
                size += 0.05;
                opacity -= 0.02;
                heart.style.transform = `translate(-50%, -50%) scale(${size})`;
                heart.style.opacity = opacity;

                if (opacity <= 0) {
                    clearInterval(animation);
                    heart.remove();
                }
            }, 50);
        }
    </script>
</body>
</html>